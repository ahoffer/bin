#!/usr/bin/env bash
set -euo pipefail

#------------------------------------------------------------------------
# Disables smartcard authentication in GDM and enforces password login
# on Ubuntu 24.04 with GNOME 46. 
#------------------------------------------------------------------------

# 1) Ensure sudo is working
if ! command -v sudo &>/dev/null; then
  echo "❌ sudo is required to run this script." >&2
  exit 1
fi

# 2) Create the GDM dconf override directory (if needed)
sudo mkdir -p /etc/dconf/db/gdm.d

# 3) Write the override file
sudo tee /etc/dconf/db/gdm.d/00-custom-login > /dev/null <<'EOF'
[org/gnome/login-screen]
# disable the “Insert smart-card” UI
enable-smartcard-authentication=false
# always show the password prompt
enable-password-authentication=true
EOF

# 4) Rebuild the system dconf database
sudo dconf update

echo "Reboot for changes to take effect"
