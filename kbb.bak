#!/usr/bin/env bash
IMAGE="busybox:1.36"
POD="kbb-$$"
LOG="$HOME/kbb.log"

[ $# -eq 0 ] && { echo "usage: $0 <command>"; exit 1; }

set -euo pipefail

kubectl run "$POD" --image="$IMAGE" --restart=Never -- sleep infinity >/dev/null
kubectl wait --for=condition=Ready pod/"$POD" --timeout=30s >/dev/null

kubectl exec "$POD" -- sh -lc "$*" 2>&1 | tee "$LOG"

kubectl delete pod "$POD" >/dev/null

