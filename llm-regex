#!/bin/bash
# Generate regex from description
# Usage: llm-regex "email address"
#        llm-regex "ISO date format" --flavor python
#        llm-regex "phone number with optional country code"

set -euo pipefail
source "$(dirname "$0")/ollama-lib"

if ! ollama_ping; then
    echo "Error: Cannot reach Ollama at $OLLAMA_HOST" >&2
    exit 1
fi

# Parse args
flavor="PCRE/JavaScript"
desc=""
while [[ $# -gt 0 ]]; do
    case "$1" in
        --flavor) flavor="$2"; shift 2 ;;
        *) desc="$desc $1"; shift ;;
    esac
done

if [[ -z "${desc// }" ]]; then
    echo "Usage: llm-regex \"description\" [--flavor python|js|go|...]" >&2
    exit 1
fi

system="Generate a regex pattern for: $desc
Flavor: $flavor

Output format:
PATTERN: <the regex>
EXPLANATION: <brief explanation of each part>
EXAMPLES: <2-3 example matches>

Be precise. Avoid overly permissive patterns."

ollama_generate "$MODEL_CHAT" "$desc" "$system"
