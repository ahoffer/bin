#!/bin/bash
# Explain an error message or stack trace
# Usage: command 2>&1 | llmexplainerror
#        llmexplainerror "error message"
#        llmexplainerror < stacktrace.txt

set -euo pipefail
source "$(dirname "$0")/ollamalib"
ollama_capture_stdin
ollama_require

# Read input from arg or stdin
if [[ $# -gt 0 ]]; then
    input="$*"
elif [[ -n "${OLLAMA_STDIN:-}" ]]; then
    input=$(echo "$OLLAMA_STDIN" | truncate_input 4000)
else
    echo "No error provided" >&2
    exit 1
fi

system="You are a helpful developer assistant. Analyze this error/stack trace and explain:
1. What the error means (1 sentence)
2. Most likely cause
3. How to fix it (specific steps)

Be concise and practical. If you recognize the error, give the common fix."

ollama_generate "$MODEL_CHAT" "$input" "$system"
