#!/usr/bin/env bash
set -euo pipefail

title="$(kitty +kitten ask --prompt 'Window title: ' || true)"
[[ -z "$title" ]] && exit 0

# Parse JSON if kitten ask returned it
if [[ "$title" == *'"response"'* ]]; then
  title="$(jq -r '.response // empty' <<< "$title")" || { echo "JSON parse failed" >&2; exit 1; }
  [[ -z "$title" ]] && exit 0
fi

match="id:${1:-${KITTY_WINDOW_ID:-}}"
[[ "$match" == "id:" ]] && match="state:focused"

kitty @ set-window-title --match "$match" "$title" 2>/dev/null || true
kitty @ set-tab-title --match "$match" "$title" 2>/dev/null || true
