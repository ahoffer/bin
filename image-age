#!/bin/bash
set -euo pipefail

# Print human-readable age of a docker image
# Usage: image-age <image>

IMAGE="${1:?Usage: image-age <image>}"

CREATED=$(docker inspect --format='{{.Created}}' "$IMAGE" 2>/dev/null) || { echo "unknown"; exit 0; }
CREATED_SECS=$(date -d "$CREATED" +%s 2>/dev/null) || { echo "unknown"; exit 0; }
AGE=$(($(date +%s) - CREATED_SECS))

if (( AGE < 60 )); then
  echo "${AGE}s"
elif (( AGE < 3600 )); then
  echo "$((AGE / 60))m"
elif (( AGE < 86400 )); then
  echo "$((AGE / 3600))h"
else
  echo "$((AGE / 86400))d"
fi
